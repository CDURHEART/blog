<script src="{{ 'assets/js/darkreader.min.js' | relative_url}}"></script>
<script>
  const changer = document.querySelector('#color-mode-changer');

  if (DarkReader) {
    DarkReader.setFetchMethod(window.fetch);
    initColorMode();
  }

  function initColorMode() {
    console.log('object');
    DarkReader.auto(false);
    switch (getColorMode()) {
      case 'light':
        DarkReader.disable();
        break;
      case 'dark':
        DarkReader.enable();
        break;
      case 'auto':
        DarkReader.auto();
        break;
    }
    renderTemplate();
  }

  function getColorMode() {
    const validModes = ['auto', 'dark', 'light'];
    try {
      const mode = localStorage.getItem('color-mode') || 'light';
      return validModes.includes(mode) ? mode : 'light';
    } catch (error) {
      return 'light';
    }
  }

  function changeColorMode() {
    DarkReader.auto(false);
    switch (getColorMode()) {
      case 'light':
        localStorage.setItem('color-mode', 'dark');
        DarkReader.enable();
        break;
      case 'dark':
        localStorage.setItem('color-mode', 'auto');
        DarkReader.auto();
        break;
      case 'auto':
        localStorage.setItem('color-mode', 'light');
        DarkReader.disable();
        break;
    }
    renderTemplate();
  }

  function renderTemplate() {
    const lightTempl = '<div class="icon-mode" title="明亮模式">{%- include svg/icon/mode/light.svg -%}</div>';

    const darkTempl = '<div class="icon-mode" title="黑暗模式">{%- include svg/icon/mode/dark.svg -%}</div>';

    const autoTempl = '<div class="icon-mode" title="自动模式"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><path d="M11 7l-3.2 9h1.9l.7-2h3.2l.7 2h1.9L13 7h-2zm-.15 5.65L12 9l1.15 3.65h-2.3zM20 8.69V4h-4.69L12 .69L8.69 4H4v4.69L.69 12L4 15.31V20h4.69L12 23.31L15.31 20H20v-4.69L23.31 12L20 8.69zm-2 5.79V18h-3.52L12 20.48L9.52 18H6v-3.52L3.52 12L6 9.52V6h3.52L12 3.52L14.48 6H18v3.52L20.48 12L18 14.48z" fill="currentColor"></path></svg></div>';

    switch (getColorMode()) {
      case 'light':
        changer.innerHTML = lightTempl;
        break;
      case 'dark':
        changer.innerHTML = darkTempl;
        break;
      case 'auto':
        changer.innerHTML = autoTempl;
        break;
      default:
        changer.innerHTML = lightTempl;
        break;
    }
  }

</script>
